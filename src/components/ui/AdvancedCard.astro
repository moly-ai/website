---
import type { Card as Props } from '~/types';
import { twMerge } from 'tailwind-merge';
import { Icon } from 'astro-icon/components';

export interface AdvancedCardProps {
  title: string;
  description?: string;
  icon?: string;
  theme?: 'default' | 'glassmorphism' | 'vintage' | 'fresh-nature' | 'nebula' | 'solar' | 'cosmic';
  flip?: boolean;
  backContent?: string;
  callToAction?: any;
  classes?: {
    container?: string;
    front?: string;
    back?: string;
    icon?: string;
    title?: string;
    description?: string;
  };
  isAnimated?: boolean;
  delay?: number;
}

const {
  title,
  description,
  icon,
  theme = 'default',
  flip = false,
  backContent,
  callToAction,
  classes = {},
  isAnimated = true,
  delay = 0,
} = Astro.props;

const themeClasses = {
  default: 'bg-card border border-bg-border hover:shadow-lg transition-all duration-300 hover:scale-105',
  glassmorphism: 'glass-card hover:bg-white/10 transition-all duration-300 hover:scale-105',
  vintage: 'bg-gradient-to-br from-amber-50 to-orange-100 dark:from-amber-900/20 dark:to-orange-900/20 border border-amber-200/50 dark:border-amber-800/30 hover:shadow-lg transition-all duration-300 hover:scale-105',
  'fresh-nature': 'bg-gradient-to-br from-green-50 to-emerald-100 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200/50 dark:border-green-800/30 hover:shadow-lg transition-all duration-300 hover:scale-105',
  nebula: 'nebula-theme bg-gradient-to-br from-nebula/10 to-tea-secondary/20 border border-nebula/30 hover:shadow-lg hover:shadow-nebula/20 transition-all duration-300 hover:scale-105',
  solar: 'solar-theme bg-gradient-to-br from-solar/10 to-yellow/20 border border-solar/30 hover:shadow-lg hover:shadow-solar/20 transition-all duration-300 hover:scale-105',
  cosmic: 'cosmic-theme bg-gradient-to-br from-cosmic/10 to-purple/20 border border-cosmic/30 hover:shadow-lg hover:shadow-cosmic/20 transition-all duration-300 hover:scale-105',
};

const iconClasses = {
  default: 'w-12 h-12 p-3 rounded-full bg-primary text-white mb-4',
  glassmorphism: 'w-12 h-12 p-3 rounded-full glass text-primary mb-4',
  vintage: 'w-12 h-12 p-3 rounded-full bg-gradient-to-br from-amber-500 to-orange-600 text-white mb-4',
  'fresh-nature': 'w-12 h-12 p-3 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 text-white mb-4',
  nebula: 'w-12 h-12 p-3 rounded-full bg-gradient-to-br from-nebula to-tea-secondary text-white mb-4',
  solar: 'w-12 h-12 p-3 rounded-full bg-gradient-to-br from-solar to-yellow-500 text-white mb-4',
  cosmic: 'w-12 h-12 p-3 rounded-full bg-gradient-to-br from-cosmic to-purple-500 text-white mb-4',
};

const animationDelay = isAnimated ? `animation-delay-${delay}` : '';
---

<div
  class={twMerge(
    'group relative h-full',
    flip ? 'flip-card-container' : '',
    isAnimated ? 'animate-on-scroll' : '',
    animationDelay,
    classes.container
  )}
  style={isAnimated ? `animation-delay: ${delay}ms` : ''}
>
  {flip ? (
    <>
      <!-- Front of card -->
      <div
        class={twMerge(
          'flip-card-face flip-card-front absolute inset-0 backface-hidden p-6 rounded-lg flex flex-col justify-between',
          themeClasses[theme],
          classes.front
        )}
      >
        <div>
          {icon && (
            <div class="flex justify-center mb-4">
              <Icon
                name={icon}
                class={twMerge('w-8 h-8', iconClasses[theme], classes.icon)}
              />
            </div>
          )}
          <h3 class={twMerge('text-xl font-bold mb-3', classes.title)}>{title}</h3>
          {description && (
            <p class={twMerge('text-muted text-sm leading-relaxed', classes.description)} set:html={description} />
          )}
        </div>

        {flip && (
          <div class="text-center mt-4">
            <button class="flip-trigger text-primary hover:text-accent text-sm font-medium transition-colors">
              Learn more →
            </button>
          </div>
        )}
      </div>

      <!-- Back of card -->
      <div
        class={twMerge(
          'flip-card-face flip-card-back absolute inset-0 backface-hidden p-6 rounded-lg bg-gradient-to-br from-primary to-accent text-white flex flex-col justify-center',
          classes.back
        )}
      >
        <div class="text-center">
          <h3 class={twMerge('text-xl font-bold mb-4', classes.title)}>{title}</h3>
          {backContent && (
            <p class="text-white/90 text-sm leading-relaxed mb-6" set:html={backContent} />
          )}
          {callToAction && (
            <button class="flip-trigger bg-white text-primary px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-100 transition-colors">
              {callToAction.text || 'Get Started'}
            </button>
          )}
        </div>
      </div>
    </>
  ) : (
    <!-- Standard card without flip -->
    <div
      class={twMerge(
        'p-6 rounded-lg flex flex-col h-full',
        themeClasses[theme],
        classes.front
      )}
    >
      <div class="flex-1">
        {icon && (
          <div class="flex justify-center mb-4">
            <Icon
              name={icon}
              class={twMerge('w-8 h-8', iconClasses[theme], classes.icon)}
            />
          </div>
        )}
        <h3 class={twMerge('text-xl font-bold mb-3', classes.title)}>{title}</h3>
        {description && (
          <p class={twMerge('text-muted text-sm leading-relaxed', classes.description)} set:html={description} />
        )}
      </div>

      {callToAction && (
        <div class="mt-4">
          <a
            href={callToAction.href || '#'}
            class="inline-flex items-center text-primary hover:text-accent font-medium text-sm transition-colors group-hover:translate-x-1 duration-200"
          >
            {callToAction.text || 'Learn more'}
            <span class="ml-1">→</span>
          </a>
        </div>
      )}
    </div>
  )}
</div>

<style>
  .flip-card-container {
    perspective: 1000px;
  }

  .flip-card-face {
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .flip-card-back {
    transform: rotateY(180deg);
  }

  .flip-card-container:hover .flip-card-front {
    transform: rotateY(180deg);
  }

  .flip-card-container:hover .flip-card-back {
    transform: rotateY(0deg);
  }

  .backface-hidden {
    backface-visibility: hidden;
  }

  .animate-on-scroll {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .animate-on-scroll.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>