---
import Image from '~/components/common/Image.astro';
import Button from '~/components/ui/Button.astro';
import ScrollingTags from '~/components/widgets/ScrollingTags.astro';

import type { Hero as Props } from '~/types';

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline,

  content = await Astro.slots.render('content'),
  actions = await Astro.slots.render('actions'),
  image = await Astro.slots.render('image'),

  id,
  bg = await Astro.slots.render('bg'),

  // Advanced options
  enableAnimatedBackground = true,
  enableScrollingTags = true,
  tags = [],
} = Astro.props;
---

<section
  class="relative min-h-screen overflow-hidden bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 md:-mt-[76px]"
  {...id ? { id } : {}}
>
  <!-- Grid Pattern Background -->
  <div
    class="absolute inset-0 bg-[linear-gradient(to_right,#0f172a_1px,transparent_1px),linear-gradient(to_bottom,#0f172a_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_110%)] opacity-40"
  >
  </div>

  <!-- Scrolling Tags -->
  {enableScrollingTags && tags && tags.length > 0 && (
    <ScrollingTags uniqueTags={tags.map(tag => typeof tag === 'string' ? tag : tag.text)} />
  )}

  <!-- Animated Gradient Orbs -->
  {enableAnimatedBackground && (
    <div class="absolute inset-0 pointer-events-none overflow-hidden">
      <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-emerald-500/30 rounded-full blur-3xl animate-pulse"></div>
      <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-blue-500/30 rounded-full blur-3xl animate-pulse delay-1000"></div>
      <div class="absolute top-1/2 right-1/3 w-64 h-64 bg-purple-500/30 rounded-full blur-2xl animate-pulse delay-2000"></div>
    </div>
  )}

  <!-- Hero Content -->
  <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-0 md:pt-[76px] pointer-events-none">
    <div class="py-12 md:py-20">
      <div class="text-center w-full">
        <div class="relative flex flex-col justify-center items-center pointer-events-auto" id="mona-text">
          <div id="hero-content" class="mb-8">
            {
              title && (
                <h1 class="mb-6 text-5xl font-bold tracking-tight text-white sm:text-7xl">
                  <Fragment set:html={title} />
                </h1>
              )
            }

            {
              subtitle && (
                <p class="mx-auto max-w-3xl text-xl text-white/90 leading-relaxed mb-8">
                  <Fragment set:html={subtitle} />
                </p>
              )
            }

            {
              actions && (
                <div class="flex flex-col sm:flex-row gap-4 justify-center opacity-0 translate-y-2 pointer-events-none transform" data-hero-button>
                  {Array.isArray(actions) ? (
                    actions.map((action) => (
                      <Button {...(action || {})} class="pointer-events-auto" />
                    ))
                  ) : (
                    <Fragment set:html={actions} />
                  )}
                </div>
              )
            }
          </div>
        </div>

        {
          image && (
            <div class="relative m-auto max-w-5xl mt-12 opacity-0 translate-y-4 transition-all duration-700 pointer-events-auto" data-hero-image>
              {typeof image === 'string' ? (
                <Fragment set:html={image} />
              ) : (
                <Image
                  class="mx-auto rounded-xl w-full"
                  widths={[400, 768, 1024, 2040]}
                  sizes="(max-width: 767px) 400px, (max-width: 1023px) 768px, (max-width: 2039px) 1024px, 2040px"
                  loading="eager"
                  width={1024}
                  height={576}
                  {...image}
                />
              )}
            </div>
          )
        }
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const heroButton = document.querySelector('[data-hero-button]') as HTMLElement | null;
    const heroImage = document.querySelector('[data-hero-image]') as HTMLElement | null;

    const startTags = () => {
      document.dispatchEvent(new Event('start-tags'));
    };

    const revealElements = () => {
      // Reveal button
      if (heroButton) {
        setTimeout(() => {
          heroButton.classList.remove('opacity-0', 'translate-y-2', 'pointer-events-none');
          heroButton.classList.add('pointer-events-auto');
        }, 800);
      }

      // Reveal image
      if (heroImage) {
        setTimeout(() => {
          heroImage.classList.remove('opacity-0', 'translate-y-4');
        }, 1000);
      }

      // Start scrolling tags
      setTimeout(() => {
        startTags();
      }, 1200);
    };

    // Simple delay to reveal elements
    setTimeout(revealElements, 300);
  });
</script>

<style>
  /* Animation delays */
  .delay-1000 {
    animation-delay: 1s;
  }

  .delay-2000 {
    animation-delay: 2s;
  }

  /* Text glow effect */
  .text-glow {
    text-shadow: 0 0 20px currentColor, 0 0 40px currentColor;
  }
</style>